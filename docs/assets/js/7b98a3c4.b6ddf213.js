"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[250],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>f});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var u=r.createContext({}),l=function(e){var t=r.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=l(e.components);return r.createElement(u.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,u=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=l(n),p=i,f=m["".concat(u,".").concat(p)]||m[p]||c[p]||a;return n?r.createElement(f,o(o({ref:t},d),{},{components:n})):r.createElement(f,o({ref:t},d))}));function f(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s[m]="string"==typeof e?e:i,o[1]=s;for(var l=2;l<a;l++)o[l]=n[l];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2486:(e,t,n)=>{n.r(t),n.d(t,{contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var r=n(7462),i=(n(7294),n(3905));const a={sidebar_position:4},o="Source / medium rules",s={unversionedId:"sessions/source-medium",id:"sessions/source-medium",isDocsHomePage:!1,title:"Source / medium rules",description:"Why do we need source / medium rules",source:"@site/docs/sessions/source-medium.md",sourceDirName:"sessions",slug:"/sessions/source-medium",permalink:"/dataform-ga4-sessions/sessions/source-medium",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/sessions/source-medium.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Intraday sessions",permalink:"/dataform-ga4-sessions/sessions/intraday-sessions"},next:{title:"Channel Grouping",permalink:"/dataform-ga4-sessions/sessions/channel-grouping"}},u=[{value:"Why do we need source / medium rules",id:"why-do-we-need-source--medium-rules",children:[]},{value:"How package define source / medium",id:"how-package-define-source--medium",children:[]},{value:"Custom source / medium rules",id:"custom-source--medium-rules",children:[]}],l={toc:u},d="wrapper";function m(e){let{components:t,...n}=e;return(0,i.kt)(d,(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"source--medium-rules"},"Source / medium rules"),(0,i.kt)("h2",{id:"why-do-we-need-source--medium-rules"},"Why do we need source / medium rules"),(0,i.kt)("p",null,"GA4 export data already has extracted source, medium and campaign keys inside ",(0,i.kt)("inlineCode",{parentName:"p"},"event_params")," column. But in some cases, you need to apply custom rules to define source / medium. For example, if for some reason traffic doesn't have correct UTM parameters but has auto generated platform click id, like ",(0,i.kt)("inlineCode",{parentName:"p"},"fbclid"),". In this case, you need custom logic to define source / medium."),(0,i.kt)("p",null,"Also, sometimes default attribution rules are not clear. For example, you could notice sessions with ",(0,i.kt)("inlineCode",{parentName:"p"},"gclid")," but not with ",(0,i.kt)("inlineCode",{parentName:"p"},"google / cpc"),". And now Google Ads uses not only ",(0,i.kt)("inlineCode",{parentName:"p"},"gclid")," but also ",(0,i.kt)("inlineCode",{parentName:"p"},"gbraid"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"wbraid")," and other query parameters that indicate that the click came from Google Ads."),(0,i.kt)("p",null,"So you need to define your own source / medium rules."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"There is one important topic about source / medium rules. GA4 doesn't break sessions if source / medium are changed during the session. The package returns source / medium based on the first founded values. It's a potential improvement for the package to also provide all found source and medium to let end-users create custom session definitions or attribution models."))),(0,i.kt)("h2",{id:"how-package-define-source--medium"},"How package define source / medium"),(0,i.kt)("p",null,"Packege processes raw GA4 data in a few steps. One of the steps is ",(0,i.kt)("inlineCode",{parentName:"p"},"sessions_with_source_medium_and_lp"),". In this step we apply source / medium rules to create last click attribution."),(0,i.kt)("p",null,"By default, the package has a few source / medium rules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"if ",(0,i.kt)("inlineCode",{parentName:"li"},"gclid")," key exists in ",(0,i.kt)("inlineCode",{parentName:"li"},"event_params")," and is not null then the source / medium set to ",(0,i.kt)("inlineCode",{parentName:"li"},"google / cpc")),(0,i.kt)("li",{parentName:"ul"},"if ",(0,i.kt)("inlineCode",{parentName:"li"},"source"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"medium"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"campaign")," keys exist in ",(0,i.kt)("inlineCode",{parentName:"li"},"event_params"),"and are not null then the source / medium set to values from these params"),(0,i.kt)("li",{parentName:"ul"},"if ",(0,i.kt)("inlineCode",{parentName:"li"},"session_referrer")," exists and is not null the source set to the value of ",(0,i.kt)("inlineCode",{parentName:"li"},"session_referrer")," and medium to ",(0,i.kt)("inlineCode",{parentName:"li"},"referral"))),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Session referre is the first not null value from ",(0,i.kt)("inlineCode",{parentName:"p"},"event_params")," with key ",(0,i.kt)("inlineCode",{parentName:"p"},"page_referrer"),". But also package checks if the value is not ",(0,i.kt)("inlineCode",{parentName:"p"},"ignore_referrer")," is not ",(0,i.kt)("inlineCode",{parentName:"p"},"true"),". GA4 has ",(0,i.kt)("a",{parentName:"p",href:"https://support.google.com/analytics/answer/10327750?hl=en#:~:text=Automatic%20self%2Dreferral%20detection"},"automatic self-referral detection\n")))),(0,i.kt)("p",null,"The rules apply in the order they are defined and the first rule which is true is applied."),(0,i.kt)("p",null,"Read more about ",(0,i.kt)("a",{parentName:"p",href:"/sessions/processing-steps"},"processing steps")),(0,i.kt)("h2",{id:"custom-source--medium-rules"},"Custom source / medium rules"),(0,i.kt)("p",null,"You could add custom source / medium rules using ",(0,i.kt)("inlineCode",{parentName:"p"},"sourceMediumRules")," property."),(0,i.kt)("p",null,"Here is an example of how to add a new source / medium rule if ",(0,i.kt)("inlineCode",{parentName:"p"},"gclid")," is found in the page_location (not in ",(0,i.kt)("inlineCode",{parentName:"p"},"event_params"),")."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Sessions(sessionConfig);\n// Add column with query parameter gclid\nsessions.addQueryParameters([{ name: "gclid", columnName: "gclid_url" }]);\n\n// Add sourceMediumRule for gclid\nsessions.sourceMediumRules = [\n  {\n    columns: ["gclid_url"],\n    conditionType: "NOT_NULL",\n    conditionValue: "",\n    value: {\n      source: "\'google\'",\n      medium: "\'cpc\'",\n      campaign: "campaign",\n    },\n  },\n  ...sessions.sourceMediumRules,\n];\nsessions.publish();\n')),(0,i.kt)("p",null,"Here we add new rule in ",(0,i.kt)("inlineCode",{parentName:"p"},"sourceMediumRules"),". The order is important, if we add a new rule at the end it wouldn't work as default source medium rule would be applied first."),(0,i.kt)("p",null,"Read more about ",(0,i.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..Session+_sourceMediumRules"},"sourceMediumRules")))}m.isMDXComponent=!0}}]);