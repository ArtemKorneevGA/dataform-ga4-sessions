"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[679],{3905:(e,t,a)=>{a.d(t,{Zo:()=>m,kt:()=>h});var n=a(7294);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){s(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,s=function(e,t){if(null==e)return{};var a,n,s={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(s[a]=e[a]);return s}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}var l=n.createContext({}),d=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},m=function(e){var t=d(e.components);return n.createElement(l.Provider,{value:t},e.children)},c="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,s=e.mdxType,o=e.originalType,l=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=d(a),u=s,h=c["".concat(l,".").concat(u)]||c[u]||p[u]||o;return a?n.createElement(h,r(r({ref:t},m),{},{components:a})):n.createElement(h,r({ref:t},m))}));function h(e,t){var a=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var o=a.length,r=new Array(o);r[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[c]="string"==typeof e?e:s,r[1]=i;for(var d=2;d<o;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},5418:(e,t,a)=>{a.r(t),a.d(t,{contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var n=a(7462),s=(a(7294),a(3905));const o={sidebar_position:1},r="Create a session",i={unversionedId:"sessions/create-session",id:"sessions/create-session",isDocsHomePage:!1,title:"Create a session",description:"The package provides a Session class to create a session table from GA4 BigQuery raw data. You could find more details about Session Class API.",source:"@site/docs/sessions/create-session.md",sourceDirName:"sessions",slug:"/sessions/create-session",permalink:"/dataform-ga4-sessions/sessions/create-session",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/sessions/create-session.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Unit Tests",permalink:"/dataform-ga4-sessions/guides/unit-tests"},next:{title:"Session presets",permalink:"/dataform-ga4-sessions/sessions/session-presets"}},l=[{value:"Declare GA4 BigQuery sources",id:"declare-ga4-bigquery-sources",children:[]},{value:"Base session action",id:"base-session-action",children:[]},{value:"Use cases",id:"use-cases",children:[{value:"Change the result table name and dataset",id:"change-the-result-table-name-and-dataset",children:[]},{value:"Add custom columns from raw GA4 data",id:"add-custom-columns-from-raw-ga4-data",children:[]},{value:"Add value from event_params",id:"add-value-from-event_params",children:[]},{value:"Add value from page_location query parameter",id:"add-value-from-page_location-query-parameter",children:[]},{value:"Apply extend preset",id:"apply-extend-preset",children:[]},{value:"Delete columns from the result table",id:"delete-columns-from-the-result-table",children:[]},{value:"Add where condition for non-incremental table",id:"add-where-condition-for-non-incremental-table",children:[]},{value:"Adding updatePartitionFilter",id:"adding-updatepartitionfilter",children:[]}]},{value:"More details",id:"more-details",children:[]}],d={toc:l},m="wrapper";function c(e){let{components:t,...a}=e;return(0,s.kt)(m,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"create-a-session"},"Create a session"),(0,s.kt)("p",null,"The package provides a Session class to create a session table from GA4 BigQuery raw data. You could find more details about ",(0,s.kt)("a",{parentName:"p",href:"/api#dataform-ga4-sessionssession--dataformaction"},"Session Class API"),"."),(0,s.kt)("h2",{id:"declare-ga4-bigquery-sources"},"Declare GA4 BigQuery sources"),(0,s.kt)("p",null,"Before you can use Session class you should declare GA4 BigQuery sources. You could do it using ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ArtemKorneevGA/dataform-ga4-helpers/blob/32841271f65eb9ff10f844fe812343de7ddab407/index.js#L182"},"declareSources")," method like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const ga4 = require("dataform-ga4-sessions");\n// Define your config\nconst config = {\n  dataset: "analytics_XXXXXX",\n  incrementalTableName: "events_XXXXXX",\n};\n// Declare GA4 source tables\nga4.declareSources(config);\n')),(0,s.kt)("p",null,"The method expects config with these keys:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"database - GCP project id, if you query data from another project"),(0,s.kt)("li",{parentName:"ul"},"dataset - GA4 dataset name, like ",(0,s.kt)("inlineCode",{parentName:"li"},"analytics_XXXXXX")),(0,s.kt)("li",{parentName:"ul"},"incrementalTableName - GA4 events table name, like ",(0,s.kt)("inlineCode",{parentName:"li"},"events_XXXXXX")," ",(0,s.kt)("a",{parentName:"li",href:"/guides/dataform#incremental-tables"},"for incremental context")),(0,s.kt)("li",{parentName:"ul"},"nonIncrementalTableName - GA4 events table name, like ",(0,s.kt)("inlineCode",{parentName:"li"},"events_XXXXXX")," for ",(0,s.kt)("a",{parentName:"li",href:"/guides/dataform#incremental-tables"},"non-incremental context"))),(0,s.kt)("p",null,"After that you could use ",(0,s.kt)("inlineCode",{parentName:"p"},'ref("events_XXXXXX")')," in your actions to SELECT from GA4 export data."),(0,s.kt)("h2",{id:"base-session-action"},"Base session action"),(0,s.kt)("p",null,"To create a session table you should create a new Session object and call publish() method. Like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const ga4 = require("dataform-ga4-sessions");\n\n// Create sessions object\nconst sessions = new ga4.Session(config);\n// Publish session table\nsessions.publish();\n')),(0,s.kt)("p",null,"Before executing these actions, you could check the Compiled Queries for incremental and non-incremental tables. Run these queries in Dataform or copy and check them in BigQuery Studio."),(0,s.kt)("p",null,"After that just execute this action. As a result in current GCP project in dataset ",(0,s.kt)("inlineCode",{parentName:"p"},"dataform_staging")," the package generates ",(0,s.kt)("inlineCode",{parentName:"p"},"sesions")," table:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"with unique session_id column, more details ",(0,s.kt)("a",{parentName:"li",href:"/sessions/session-id"},"here")),(0,s.kt)("li",{parentName:"ul"},'predefined "standard" schema. You could find more details about it ',(0,s.kt)("a",{parentName:"li",href:"/sessions/session-presets"},"here")),(0,s.kt)("li",{parentName:"ul"},"source / medium fields. Read more about how to add ",(0,s.kt)("a",{parentName:"li",href:"/sessions/source-medium"},"custom source / medium rules")),(0,s.kt)("li",{parentName:"ul"},"two attribution models: last click and linear. Read how to ",(0,s.kt)("a",{parentName:"li",href:"/sessions/attribution"},"customize them")),(0,s.kt)("li",{parentName:"ul"},"channel grouping field. Read more about ",(0,s.kt)("a",{parentName:"li",href:"/sessions/channel-grouping"},"channel grouping"))),(0,s.kt)("h2",{id:"use-cases"},"Use cases"),(0,s.kt)("h3",{id:"change-the-result-table-name-and-dataset"},"Change the result table name and dataset"),(0,s.kt)("p",null,"By default, the package creates ",(0,s.kt)("inlineCode",{parentName:"p"},"sessions")," table in ",(0,s.kt)("inlineCode",{parentName:"p"},"dataform_staging")," dataset, but you could change result table name and dataset like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\n\nsessions.target = {\n  schema: "my_schema",\n  tableName: "my_sessions_table",\n};\n\nsessions.publish();\n')),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+_target"},"target property")),(0,s.kt)("h3",{id:"add-custom-columns-from-raw-ga4-data"},"Add custom columns from raw GA4 data"),(0,s.kt)("p",null,"If you want to extend the result table with custom columns from raw GA4 data you could use ",(0,s.kt)("inlineCode",{parentName:"p"},"addColumns")," method like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\nsessions.addColumns([\n  { name: "device.web_info.browser", columnName: "browser" },\n]);\nsessions.publish();\n')),(0,s.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"If you add columns with ",(0,s.kt)("inlineCode",{parentName:"p"},"RECORD")," type, like: ",(0,s.kt)("inlineCode",{parentName:"p"},"device.*"),", ",(0,s.kt)("inlineCode",{parentName:"p"},"geo.*")," you should specify the ",(0,s.kt)("inlineCode",{parentName:"p"},"columnName"),". Because the result column name couldn't have a dot (.) symbol in the name."))),(0,s.kt)("p",null,"Using this method you could add any column from raw GA4 data. If you need to unnest values from event_params or user_properties by key name the class provide special methods ",(0,s.kt)("inlineCode",{parentName:"p"},"addEventParams")," and ",(0,s.kt)("inlineCode",{parentName:"p"},"addUserProperties"),"."),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"This method returns a session scope value. It means it tries to get the first not null column value from all events during the sessions (with the same ",(0,s.kt)("inlineCode",{parentName:"p"},"session_id"),"). So it means it not nesseary the value from the first event."))),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+addColumns"},"addColumns method")),(0,s.kt)("h3",{id:"add-value-from-event_params"},"Add value from event_params"),(0,s.kt)("p",null,"You could unnest value from event_params by key name using ",(0,s.kt)("inlineCode",{parentName:"p"},"addEventParams")," method like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\n\nsessions.addEventParams([{ name: "ignore_referrer", type: "string" }]);\nsessions.publish();\n')),(0,s.kt)("p",null,"Because ",(0,s.kt)("inlineCode",{parentName:"p"},"event_params")," contains values of different types, you should specify the value type. This types are supported: string, int, double, float, coalesce, coalesce_float."),(0,s.kt)("p",null,"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"COALESCE")," type to get the first not null value of any type converted to a string.\nUse ",(0,s.kt)("inlineCode",{parentName:"p"},"COALESCE_FLOAT")," to get the first not null numeric value converted to float."),(0,s.kt)("p",null,"For more details check out ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/ArtemKorneevGA/dataform-ga4-helpers/blob/b695120595cf1c6f0d86fe6aab031e01e8e2756b/index.js#L25"},"getSqlUnnestParam")),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"This method returns a session scope value. It means it tries to get the first not null value from all events during the sessions (with the same ",(0,s.kt)("inlineCode",{parentName:"p"},"session_id"),")."))),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+addEventParams"},"addEventParams method")),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+addUserProperties"},"addUserProperties method")),(0,s.kt)("h3",{id:"add-value-from-page_location-query-parameter"},"Add value from page_location query parameter"),(0,s.kt)("p",null,"A rather common task is to extract query parameters from URL. For example to collect ",(0,s.kt)("inlineCode",{parentName:"p"},"fbclid")," or other platforms click id. The class provides ",(0,s.kt)("inlineCode",{parentName:"p"},"addQueryParameters")," method. This method tries to extract query parameter from ",(0,s.kt)("inlineCode",{parentName:"p"},"event_param")," with a key ",(0,s.kt)("inlineCode",{parentName:"p"},"page_location")," from any session event. And returns the first not null value."),(0,s.kt)("p",null,"You could use this method like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\n\nsessions.addQueryParameters([\n  { name: "fbclid" },\n  { name: "ttclid" },\n  { name: "gclid", columnName: "gclid_url" },\n]);\nsessions.publish();\n')),(0,s.kt)("p",null,"In this example we change the column name for ",(0,s.kt)("inlineCode",{parentName:"p"},"gclid")," from query parameters because the standard schema already has column gclid from ",(0,s.kt)("inlineCode",{parentName:"p"},"event_params"),"."),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"The method returns session-scope value (the first value during the session) not the event-scope value."))),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+addQueryParameters"},"addQueryParameters method")),(0,s.kt)("h3",{id:"apply-extend-preset"},"Apply extend preset"),(0,s.kt)("p",null,"You could apply extended preset to get more session scope columns. Like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\nsessions.applyPreset("extended");\nsessions.publish();\n')),(0,s.kt)("p",null,"You could compare schemas for standard and extended presets ",(0,s.kt)("a",{parentName:"p",href:"/sessions/session-presets"},"here"),"."),(0,s.kt)("h3",{id:"delete-columns-from-the-result-table"},"Delete columns from the result table"),(0,s.kt)("p",null,"If you don't want to store some columns but you need them for processing steps you could delete them using ",(0,s.kt)("inlineCode",{parentName:"p"},"sessions.postProcessing.delete")," like this:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\n\nsessions.postProcessing.delete = [\n  ...sessions.postProcessing.delete,\n  ...["gclid", "content"],\n];\n\nsessions.publish();\n')),(0,s.kt)("p",null,"By default postProcessing.delete equals ","[source, medium, campaign]",". These columns should be deleted because they are already stored in the last_click_attribution column."),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..Session+_postProcessing"},"postProcessing")),(0,s.kt)("h3",{id:"add-where-condition-for-non-incremental-table"},"Add where condition for non-incremental table"),(0,s.kt)("p",null,"You could add diferent ",(0,s.kt)("inlineCode",{parentName:"p"},"WHERE")," condition for incremental and non-incremental tables."),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessionConfig = {\n  dataset: "analytics_XXXXXX",\n  incrementalTableName: "events_XXXXXX",\n  nonIncrementalTableEventStepWhere:\n    "_table_suffix between format_date(\'%Y%m%d\',date_sub(current_date(), interval 3 day)) and format_date(\'%Y%m%d\',date_sub(current_date(), interval 1 day))",\n};\nconst sessions = new ga4.Session(sessionConfig);\nsessions.publish();\n')),(0,s.kt)("p",null,"For incremental you could use the similar property ",(0,s.kt)("inlineCode",{parentName:"p"},"incrementalTableEventStepWhere"),"."),(0,s.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,s.kt)("div",{parentName:"div",className:"admonition-heading"},(0,s.kt)("h5",{parentName:"div"},(0,s.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,s.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,s.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,s.kt)("div",{parentName:"div",className:"admonition-content"},(0,s.kt)("p",{parentName:"div"},"This method applies to the first step, not to the last. So use it carefully as you could filter events before extracting the needed columns from them. For example source / medium values."))),(0,s.kt)("p",null,"For example you could use different ",(0,s.kt)("inlineCode",{parentName:"p"},"WHERE")," conditions for ",(0,s.kt)("a",{parentName:"p",href:"/guides/scheduling-daily"},"schedule daily updates"),"."),(0,s.kt)("p",null,"More about ",(0,s.kt)("a",{parentName:"p",href:"/api#module_dataform-ga4-sessions..DataformAction+_source"},"source property")),(0,s.kt)("h3",{id:"adding-updatepartitionfilter"},"Adding updatePartitionFilter"),(0,s.kt)("p",null,"You could filter rows in a incremental table adding ",(0,s.kt)("a",{parentName:"p",href:"https://cloud.google.com/dataform/docs/incremental-tables#filter_rows_in_an_incremental_table"},"updatePartitionFilter"),":"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},'const sessions = new ga4.Session(sessionConfig);\nsessions.updatePartitionFilter =\n  "date >= date_sub(current_date(), interval 5 day)";\nsessions.publish();\n')),(0,s.kt)("p",null,"Actually this way you can add any of ",(0,s.kt)("a",{parentName:"p",href:"https://cloud.google.com/dataform/docs/reference/dataform-core-reference#bigquery"},"IBigQueryOptions")),(0,s.kt)("p",null,"Read more about:"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/api#module_dataform-ga4-sessions..DataformAction+_clusterBy"},"clusterBy")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/api#module_dataform-ga4-sessions..DataformAction+_updatePartitionFilter"},"updatePartitionFilter")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/api#module_dataform-ga4-sessions..DataformAction+_additionalOptions"},"additionalOptions")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/api#module_dataform-ga4-sessions..DataformAction+_partitionExpirationDays"},"partitionExpirationDays")),(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/api#module_dataform-ga4-sessions..DataformAction+_requirePartitionFilter"},"requirePartitionFilter"))),(0,s.kt)("h2",{id:"more-details"},"More details"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},"if you want to learn more about how the package works, you could read about ",(0,s.kt)("a",{parentName:"li",href:"/sessions/processing-steps"},"processing steps")),(0,s.kt)("li",{parentName:"ul"},"and how to deal with ",(0,s.kt)("a",{parentName:"li",href:"/sessions/intraday-sessions"},"intraday sessions"))))}c.isMDXComponent=!0}}]);